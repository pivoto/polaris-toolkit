# 注解操作

## io.polaris.core.lang.annotation.Annotations

### 概述
Annotations 类提供了对 Java 注解的各种高级操作功能。它支持获取普通注解、可重复注解、合并注解以及动态创建注解实例等功能。

### 获取单个注解

#### 功能描述
从 `AnnotatedElement` 中获取指定类型的注解实例。

#### 方法签名
```java
public static <A extends Annotation> A getRawAnnotation(AnnotatedElement element, Class<A> annotationType)
```

#### 使用示例
```java
// 获取类上的 Deprecated 注解
Deprecated deprecated = Annotations.getRawAnnotation(MyClass.class, Deprecated.class);
```

### 获取可重复注解数组

#### 功能描述
获取标记为 `@Repeatable` 的注解的所有实例。

#### 方法签名
```java
public static <A extends Annotation> A[] getRawRepeatableAnnotation(AnnotatedElement element, Class<A> annotationType)
```

#### 使用示例
```java
// 获取所有 Author 注解实例
Author[] authors = Annotations.getRawRepeatableAnnotation(MyClass.class, Author.class);
```

### 获取合并后的注解

#### 功能描述
获取经过元注解合并处理后的注解实例，支持注解继承和覆盖。

#### 方法签名
```java
public static <A extends Annotation> A getMergedAnnotation(AnnotatedElement element, Class<A> annotationType)
```

#### 使用示例
```java
// 获取合并后的 RequestMapping 注解
RequestMapping mapping = Annotations.getMergedAnnotation(MyMethod.class, RequestMapping.class);
```

### 获取合并后的可重复注解集合

#### 功能描述
获取经过合并处理的可重复注解集合。

#### 方法签名
```java
public static <A extends Annotation> Set<A> getMergedRepeatableAnnotation(AnnotatedElement element, Class<A> annotationType)
```

#### 使用示例
```java
// 获取合并后的所有权限注解
Set<Permission> permissions = Annotations.getMergedRepeatableAnnotation(MyClass.class, Permission.class);
```

### 动态创建注解实例

#### 功能描述
根据注解类型和属性值映射关系动态创建注解实例。

#### 方法签名
```java
public static <A extends Annotation> A newInstance(Class<A> annotationType, Map<String, Object> values)
```

#### 使用示例
```java
Map<String, Object> values = new HashMap<>();
values.put("value", "/api/users");
RequestMapping mapping = Annotations.newInstance(RequestMapping.class, values);
```

### 获取容器注解中的重复注解

#### 功能描述
从容器注解中获取其包含的重复注解数组。

#### 方法签名
```java
public static Annotation[] getRepeatedAnnotations(Annotation annotation)
```

#### 使用示例
```java
// 获取 Authors 容器注解中的 Author 注解数组
Authors authors = clazz.getAnnotation(Authors.class);
Annotation[] authorAnnotations = Annotations.getRepeatedAnnotations(authors);
```

### 获取可重复注解的容器注解类型

#### 功能描述
获取可重复注解对应的容器注解类型。

#### 方法签名
```java
public static Class<? extends Annotation> getRepeatedAnnotationType(Class<? extends Annotation> annotationType)
```

#### 使用示例
```java
// 获取 Author 注解的容器类型
Class<? extends Annotation> containerType = Annotations.getRepeatedAnnotationType(Author.class);
```

### 判断注解是否可重复

#### 功能描述
判断给定的注解类型是否标记为 `@Repeatable`。

#### 方法签名
```java
public static <A extends Annotation> boolean isRepeatable(Class<A> annotationType)
```

#### 使用示例
```java
// 检查 Author 注解是否可重复
boolean repeatable = Annotations.isRepeatable(Author.class);
```

### 检查注解是否定义了别名

#### 功能描述
检查注解类型是否定义了别名。

#### 方法签名
```java
public static <A extends Annotation> boolean hasAliasDefinition(Class<A> annotationType)
```

#### 使用示例
```java
// 检查 RequestMapping 是否定义了别名
boolean hasAlias = Annotations.hasAliasDefinition(RequestMapping.class);
```

## io.polaris.core.lang.annotation.AnnotationAttributes

### 概述
AnnotationAttributes 是一个用于处理 Java 注解属性的工具类。它提供了统一的接口来访问、转换和管理注解的属性值，支持类型安全的属性获取和动态属性设置。
主要用途：
- 将注解实例包装为可操作的属性映射
- 提供类型安全的属性值访问和转换
- 支持动态修改注解属性值
- 处理嵌套注解和注解数组

### 核心功能
#### 创建 AnnotationAttributes 实例
基于现有注解创建
```java
// 基于现有的注解实例创建 AnnotationAttributes
RequestMapping requestMapping = method.getAnnotation(RequestMapping.class);
AnnotationAttributes attrs = AnnotationAttributes.of(requestMapping);
```
基于注解类型创建（使用默认值）
```java
// 基于注解类型创建，属性值为默认值
AnnotationAttributes defaultAttrs = AnnotationAttributes.of(RequestMapping.class);
```
#### 获取注解属性值
基础类型属性获取
```java
AnnotationAttributes attrs = AnnotationAttributes.of(requestMapping);

// 获取原始值
String[] paths = (String[]) attrs.get("path");

// 类型安全获取
String[] methods = attrs.getStringArray("method");
Integer timeout = attrs.get("timeout", Integer.class);
Boolean async = attrs.getBoolean("async");
```

复杂类型属性获取
```java
// 获取嵌套注解
Annotation responseBody = attrs.getAnnotation("responseBody");

// 获取注解数组
Annotation[] annotations = attrs.getAnnotationArray("annotations");

// 获取嵌套的 AnnotationAttributes
AnnotationAttributes nestedAttrs = attrs.getAnnotationAttributes("nestedAnnotation");
```

#### 设置注解属性值
```java
// 创建可修改的 AnnotationAttributes 实例
AnnotationAttributes attrs = AnnotationAttributes.of(RequestMapping.class);

// 设置单个属性
attrs.set("path", new String[]{"/api/users"});

// 批量设置属性
Map<String, Object> values = new HashMap<>();
values.put("method", new RequestMethod[]{RequestMethod.GET});
values.put("consumes", new String[]{"application/json"});
attrs.set(values);

```

#### 转换功能
转换回注解实例
```java
// 将 AnnotationAttributes 转换回真实的注解实例
RequestMapping mapping = (RequestMapping) attrs.asAnnotation();
```
转换为 Map
```java
// 将属性值转换为 Map
Map<String, Object> map = attrs.asMap();
```

### 代码示例

```java
import io.polaris.core.lang.annotation.AnnotationAttributes;
import java.lang.annotation.Annotation;

// 1. 获取方法上的注解
RequestMapping requestMapping = method.getAnnotation(RequestMapping.class);

// 2. 创建 AnnotationAttributes 实例
AnnotationAttributes attrs = AnnotationAttributes.of(requestMapping);

// 3. 读取属性值
String[] paths = attrs.getStringArray("path");
String[] methods = attrs.getStringArray("method");
String[] consumes = attrs.getStringArray("consumes");
String[] produces = attrs.getStringArray("produces");

// 4. 处理复杂属性
Annotation[] annotations = attrs.getAnnotationArray("annotations");

// 5. 动态创建新的注解实例
AnnotationAttributes newAttrs = AnnotationAttributes.of(RequestMapping.class);
newAttrs.set("path", new String[]{"/api/new-endpoint"});
newAttrs.set("method", new RequestMethod[]{RequestMethod.POST});

// 6. 转换回注解
RequestMapping newMapping = (RequestMapping) newAttrs.asAnnotation();
```

处理嵌套注解示例
```java
// 处理包含嵌套注解的复杂场景
AnnotationAttributes serviceAttrs = AnnotationAttributes.of(Service.class);

// 获取嵌套注解
Annotation qualifier = serviceAttrs.getAnnotation("qualifier");

// 获取嵌套注解的属性
if (qualifier != null) {
    AnnotationAttributes qualifierAttrs = AnnotationAttributes.of(qualifier);
    String qualifierValue = qualifierAttrs.getString("value");
}
```

